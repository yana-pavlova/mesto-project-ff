(()=>{"use strict";var t,e="aa9ec73b-b4d9-4065-8418-0cee1c64b5ef",n="https://mesto.nomoreparties.co/v1/wff-cohort-11/",o=function(t,o){return u("".concat(n,"cards"),{method:"POST",headers:{authorization:e,"Content-type":"application/json"},body:JSON.stringify({name:t,link:o})}).then((function(t){return t}))},r=function(t){return u("".concat(n,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:e,"Content-type":"application/json"}})},c=function(t){return u("".concat(n,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:e,"Content-type":"application/json"}})},i=function(t){return fetch("".concat(t),{method:"HEAD"}).then((function(t){return t.ok?t:Promise.reject("Ошибка: ".concat(t.status))}))},u=function(t,e){return fetch(t,e).then(a)},a=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},l=document.querySelector("#card-template").content;function s(e,n,o,r,c,i){var u=l.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__image"),s=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like"),f=u.querySelector(".card__like-button"),m=e._id;return u.setAttribute("id",m),a.src=e.link,a.alt=e.name,s.textContent=e.name,p.textContent=e.likes.length,function(t,e){return t.some((function(t){return t._id===e}))}(e.likes,t)&&f.classList.add("card__like-button_is-active"),e.owner._id===t?d.addEventListener("click",(function(){return o(m)})):d.remove(),f.addEventListener("click",(function(t){i(t.target,p,r,c,e._id)})),a.addEventListener("click",(function(){return n(a,s)})),u}function d(t){t.classList.add("popup_is-opened"),window.addEventListener("keydown",f)}function p(t){t.classList.remove("popup_is-opened"),window.removeEventListener("keydown",f)}function f(t){t.key&&"escape"===t.key.toLowerCase()&&p(document.querySelector(".popup_is-opened"))}var m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",spanErrorSelector:"input-error"};function y(t,e,n,o,r){t.classList.add(n),t.textContent=e,o.classList.add(r)}function _(t,e,n,o){t.classList.remove(e),t.textContent="",n.classList.remove(o)}function v(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))}function h(t,e){var n=t.querySelector(e.submitButtonSelector),o=Array.from(t.querySelectorAll(e.inputSelector));o.forEach((function(n){_(t.querySelector(".".concat(n.name,"-input-error")),e.errorClass,n,e.inputErrorClass)})),v(o,n,e.inactiveButtonClass)}function S(t){var e,n;"new-place"===t.target.name?(e=t.target.querySelector(".link-input-error"),n=t.target.querySelector(".popup__input_type_url")):(e=t.target.querySelector(".profile-url-input-error"),n=t.target.querySelector(".popup__input_type_profile-url")),y(e,"Вставьте ссылку на изображение",m.errorClass,n,m.inputErrorClass)}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}var C,E=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),L=document.querySelector(".popup_type_profile_edit"),x=q.querySelector("#popup-image"),w=q.querySelector("#popup-description"),A=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_card-remove"),P=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__add-button"),T=document.querySelectorAll(".popup__close"),z=document.querySelectorAll(".popup"),D=document.forms["edit-profile"],V=document.forms["new-place"],O=document.forms["edit-profile-avatar"],N=document.querySelector(".profile__title"),H=document.querySelector(".profile__description"),J=document.forms["card-remove"];function M(t){E.prepend(t)}function G(t){t.submitter.textContent="Сохранение..."}function I(t){t.submitter.textContent="Сохранить"}function U(t){t.reset()}function F(t,e){x.src="",x.alt="",w.textContent="",x.src=t.src,x.alt=e.textContent,w.textContent=e.textContent,d(q)}function K(t){var e=j.querySelector(".popup__form");d(j),e.setAttribute("id",t)}function Q(t,e,n,o,r){t.classList.contains("card__like-button_is-active")?n(r).then((function(n){e.textContent=n.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){return console.log(t)})):o(r).then((function(n){t.classList.add("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){return console.log(t)}))}P.addEventListener("click",(function(){U(D),d(g),h(D,m)})),A.addEventListener("click",(function(){U(O),d(L),h(O,m)})),B.addEventListener("click",(function(){U(V),d(k),h(V,m)})),T.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return p(e)}))})),z.forEach((function(t){t.addEventListener("click",(function(e){return function(t,e){t.target.classList.contains("popup")&&p(e)}(e,t)}))})),V.addEventListener("submit",(function(t){return function(t,e,n,o){t.preventDefault();var u=V.elements["place-name"].value,a=V.elements.link.value,l=V.elements[2];G(t),i(a).then((function(){return o(u,a)})).then((function(t){var o,i,l,s,d={name:u,link:a,alt:u,_id:t._id,owner:(o={},i="_id",l=t.owner._id,s=function(t,e){if("object"!=b(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=b(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==b(s)?s:String(s))in o?Object.defineProperty(o,i,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[i]=l,o),likes:t.likes||[]};n(e(d,F,K,r,c,Q)),p(k),U(V)})).finally((function(){return I(t)})).catch((function(e){S(t),console.log(e)})),v([V.elements["place-name"],V.elements.link],l,m.inactiveButtonClass)}(t,s,M,o)})),D.addEventListener("submit",(function(t){t.preventDefault();var o,r,c=D.elements.name.value,i=D.elements.description.value;G(t),(o=c,r=i,u("".concat(n,"users/me"),{method:"PATCH",headers:{authorization:e,"Content-type":"application/json"},body:JSON.stringify({name:o,about:r})})).then((function(){N.textContent=c,H.textContent=i,D.elements.name.defaultValue=N.textContent,D.elements.description.defaultValue=H.textContent,p(g)})).finally((function(){return I(t)})).catch((function(t){return console.log(t)}))})),O.addEventListener("submit",(function(t){return function(t){t.preventDefault();var o=O.elements["profile-url"].value;G(t),i(o).then((function(){var t;(t=o,u("".concat(n,"users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-type":"application/json"},body:JSON.stringify({avatar:t})})).then((function(){A.style["background-image"]="url('".concat(o,"')"),p(L),U(O)}))})).finally((function(){return I(t)})).catch((function(e){S(t),console.log(e)}))}(t)})),J.addEventListener("submit",(function(t){return function(t){t.preventDefault();var o,r=t.target.id,c=document.getElementById(r);(o=r,u("".concat(n,"cards/").concat(o),{method:"DELETE",headers:{authorization:e}})).then((function(){c.remove(),p(j)})).catch((function(t){return console.log(t)}))}(t)})),C=m,Array.from(document.querySelectorAll(C.formSelector)).forEach((function(t){return function(t,e){var n=t.querySelector(e.submitButtonSelector),o=e.errorClass,r=Array.from(t.querySelectorAll(e.inputSelector));v(r,n,e.inactiveButtonClass),r.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n,o,r){var c=t.querySelector(".".concat(e.name,"-").concat(r));e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?0==e.value?y(c,"Строка не может состоять из одних пробелов",n,e,o):_(c,n,e,o):y(c,e.validationMessage,n,e,o)}(t,c,o,e.inputErrorClass,e.spanErrorSelector),v(r,n,e.inactiveButtonClass)}))}))}(t,C)}));var R=[function(){u("".concat(n,"users/me"),{method:"GET",headers:{authorization:e}}).then((function(e){return n=e._id,t=n,e;var n})).then((function(t){N.textContent=t.name,H.textContent=t.about,A.style["background-image"]='url("'.concat(t.avatar,'")'),D.elements.name.defaultValue=t.name,D.elements.description.defaultValue=t.about})).catch((function(t){return console.log(t)}))},function(){u("".concat(n,"cards"),{method:"GET",headers:{authorization:e}}).then((function(t){t.reverse().forEach((function(t){return M(s(t,F,K,r,c,Q))}))})).catch((function(t){return console.log(t)}))}];Promise.all(R).then((function(t){return t.forEach((function(t){return t()}))})).catch((function(t){return console.log(t)}))})();