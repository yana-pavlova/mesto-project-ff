(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),p:""};t.d({},{t:()=>B}),t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p;var e,n="aa9ec73b-b4d9-4065-8418-0cee1c64b5ef",o="https://mesto.nomoreparties.co/v1/wff-cohort-11/",r=function(t,e){return a("".concat(o,"cards"),{method:"POST",headers:{authorization:n,"Content-type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t}))},c=function(t){return a("".concat(o,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:n,"Content-type":"application/json"}})},i=function(t){return a("".concat(o,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:n,"Content-type":"application/json"}})},u=function(t){return fetch("".concat(t),{method:"HEAD"}).then((function(t){return t.ok?t:Promise.reject("Ошибка: ".concat(t.status))}))},a=function(t,e){return fetch(t,e).then(l)},l=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},s=document.querySelector("#card-template").content;function p(t,n,o,r,c,i){var u=s.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__image"),l=u.querySelector(".card__title"),p=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like"),f=u.querySelector(".card__like-button"),m=t._id;return u.setAttribute("id",m),a.src=t.link,a.alt=t.name,l.textContent=t.name,d.textContent=t.likes.length,function(t,e){return t.some((function(t){return t._id===e}))}(t.likes,e)&&f.classList.add("card__like-button_is-active"),t.owner._id===e?p.addEventListener("click",(function(){return o(B,m)})):p.remove(),f.addEventListener("click",(function(e){i(e.target,d,r,c,t._id)})),a.addEventListener("click",(function(){return n(a,l)})),u}function d(t){t.classList.add("popup_is-opened"),window.addEventListener("keydown",m)}function f(t){t.classList.remove("popup_is-opened"),window.removeEventListener("keydown",m)}function m(t){t.key&&"escape"===t.key.toLowerCase()&&f(document.querySelector(".popup_is-opened"))}function y(t,e){var n=t.querySelector(".popup__form");d(t),n.setAttribute("id",e)}var v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",spanErrorSelector:"input-error"};function _(t,e,n,o,r){t.classList.add(n),t.textContent=e,o.classList.add(r)}function h(t,e,n,o){t.classList.remove(e),t.textContent="",n.classList.remove(o)}function S(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))}function b(t,e){var n=t.querySelector(e.submitButtonSelector),o=Array.from(t.querySelectorAll(e.inputSelector));o.forEach((function(n){h(t.querySelector(".".concat(n.name,"-input-error")),e.errorClass,n,e.inputErrorClass)})),S(o,n,e.inactiveButtonClass)}function C(t){var e,n;"new-place"===t.target.name?(e=t.target.querySelector(".link-input-error"),n=t.target.querySelector(".popup__input_type_url")):(e=t.target.querySelector(".profile-url-input-error"),n=t.target.querySelector(".popup__input_type_profile-url")),_(e,"Вставьте ссылку на изображение",v.errorClass,n,v.inputErrorClass)}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}var E,k=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),w=document.querySelector(".popup_type_image"),x=document.querySelector(".popup_type_profile_edit"),j=w.querySelector("#popup-image"),A=w.querySelector("#popup-description"),P=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_card-remove"),T=document.querySelector(".profile__edit-button"),z=document.querySelector(".profile__add-button"),O=document.querySelectorAll(".popup__close"),D=document.querySelectorAll(".popup"),V=document.forms["edit-profile"],N=document.forms["new-place"],H=document.forms["edit-profile-avatar"],J=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),G=document.forms["card-remove"];function I(t){k.prepend(t)}function U(t){t.submitter.textContent="Сохранение..."}function F(t){t.submitter.textContent="Сохранить"}function K(t){t.reset()}function Q(t,e){j.src="",j.alt="",A.textContent="",j.src=t.src,j.alt=e.textContent,A.textContent=e.textContent,d(w)}function R(t,e,n,o,r){t.classList.contains("card__like-button_is-active")?n(r).then((function(n){e.textContent=n.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){return console.log(t)})):o(r).then((function(n){t.classList.add("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){return console.log(t)}))}T.addEventListener("click",(function(){K(V),d(q),b(V,v)})),P.addEventListener("click",(function(){K(H),d(x),b(H,v)})),z.addEventListener("click",(function(){K(N),d(L),b(N,v)})),O.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return f(e)}))})),D.forEach((function(t){t.addEventListener("click",(function(e){return function(t,e){t.target.classList.contains("popup")&&f(e)}(e,t)}))})),N.addEventListener("submit",(function(t){return function(t,e,n,o){t.preventDefault();var r=N.elements["place-name"].value,a=N.elements.link.value,l=N.elements[2];U(t),u(a).then((function(){return o(r,a)})).then((function(t){var o,u,l,s,p={name:r,link:a,alt:r,_id:t._id,owner:(o={},u="_id",l=t.owner._id,s=function(t,e){if("object"!=g(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=g(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(u),(u="symbol"==g(s)?s:String(s))in o?Object.defineProperty(o,u,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[u]=l,o),likes:t.likes||[]};n(e(p,Q,y,c,i,R)),f(L),K(N)})).finally((function(){return F(t)})).catch((function(e){C(t),console.log(e)})),S([N.elements["place-name"],N.elements.link],l,v.inactiveButtonClass)}(t,p,I,r)})),V.addEventListener("submit",(function(t){t.preventDefault();var e,r,c=V.elements.name.value,i=V.elements.description.value;U(t),(e=c,r=i,a("".concat(o,"users/me"),{method:"PATCH",headers:{authorization:n,"Content-type":"application/json"},body:JSON.stringify({name:e,about:r})})).then((function(){J.textContent=c,M.textContent=i,V.elements.name.defaultValue=J.textContent,V.elements.description.defaultValue=M.textContent,f(q)})).finally((function(){return F(t)})).catch((function(t){return console.log(t)}))})),H.addEventListener("submit",(function(t){return function(t){t.preventDefault();var e=H.elements["profile-url"].value;U(t),u(e).then((function(){var t;(t=e,a("".concat(o,"users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-type":"application/json"},body:JSON.stringify({avatar:t})})).then((function(){P.style["background-image"]="url('".concat(e,"')"),f(x),K(H)}))})).finally((function(){return F(t)})).catch((function(e){C(t),console.log(e)}))}(t)})),G.addEventListener("submit",(function(t){return function(t){t.preventDefault();var e,r=t.target.id,c=document.getElementById(r);(e=r,a("".concat(o,"cards/").concat(e),{method:"DELETE",headers:{authorization:n}})).then((function(){c.remove(),f(B)})).catch((function(t){return console.log(t)}))}(t)})),E=v,Array.from(document.querySelectorAll(E.formSelector)).forEach((function(t){return function(t,e){var n=t.querySelector(e.submitButtonSelector),o=e.errorClass,r=Array.from(t.querySelectorAll(e.inputSelector));S(r,n,e.inactiveButtonClass),r.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n,o,r){var c=t.querySelector(".".concat(e.name,"-").concat(r));e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?0==e.value?_(c,"Строка не может состоять из одних пробелов",n,e,o):h(c,n,e,o):_(c,e.validationMessage,n,e,o)}(t,c,o,e.inputErrorClass,e.spanErrorSelector),S(r,n,e.inactiveButtonClass)}))}))}(t,E)}));var W=[function(){a("".concat(o,"users/me"),{method:"GET",headers:{authorization:n}}).then((function(t){return n=t._id,e=n,t;var n})).then((function(t){J.textContent=t.name,M.textContent=t.about,P.style["background-image"]='url("'.concat(t.avatar,'")'),V.elements.name.defaultValue=t.name,V.elements.description.defaultValue=t.about})).catch((function(t){return console.log(t)}))},function(){a("".concat(o,"cards"),{method:"GET",headers:{authorization:n}}).then((function(t){t.reverse().forEach((function(t){return I(p(t,Q,y,c,i,R))}))})).catch((function(t){return console.log(t)}))}];Promise.all(W).then((function(t){return t.forEach((function(t){return t()}))})).catch((function(t){return console.log(t)}))})();